# 应用层

> 主机程序的体系结构

* 服务器-客户端体系结构
* P2P体系结构(对等体系结构)

> 嵌套字(socket)

是同一台主机内应用层和传输层之间的接口，由于该嵌套字是建立网络应用程序的可编辑接口，所以嵌套字也称为应用程序与网络之间的**应用程序编辑接口**

在因特网中**IP地址**作为主机标识符，除了需要知道目的地的主机地址外，我们还需要明确接收主机上的接收进程，这个我们用**端口号**来实现

嵌套字是应用程序进程与运输层之间的接口。当开发应用程序的时候，需要选择一种可用的运输层协议，主要参考如下：**可靠数据传输**，**吞吐量**，**定时**，**安全性**

* 可靠数据传输

确保发送端数据正确的，完整的交付给接收方

* 吞吐量

该可用的传输速率

运输层提供确保可用的吞吐量

对吞吐量有确定要求的应用程序叫**带宽敏感应用**，而没要求的是**弹性应用**

* 定时

对时延有一定保证

* 安全性

提供加密，数据完整性，端点鉴别等安全性功能

TCP可以提供可靠数据传输，SSL可以提供安全性，但是当今网络运输层还没提供确定定时时间和吞吐量服务，但是否时间敏感应用不能在当今网络中使用呢，答案肯定是否定的。好的设计其实可以做到很好的时延和带宽限制，所以，今天因特网能够为时间带宽敏感的应用提供满意的服务，但不能提供定时和吞吐量保证

---------

应用层可以选择运输层协议TCP或UDP

#### TCP

提供**面向连接服务**和**可靠数据传输服务**

> 面向连接服务

就是一个握手过程，提供在客户端和服务端交换传输层控制信息，在握手之后，在连个进程嵌套字之间建立一个TCP连接，这个连接是**双工**的

> 可靠数据传输服务

进程依靠TCP无差错，按适当顺序交付所有发送数据。当应用程序的字节流传入嵌套字时，它能依靠TCP将相同的字节流交付给接收方的嵌套字，且无丢失和冗余

TCP还提供拥塞控制机制。当网络出现拥塞时，TCP会抑制发送进程。这个对整体网络有好处

> SSL(Secure Sockets Layer)安全嵌套字层

无论是TCP还是UDP都不提供加密服务，为了安全考虑，研制了TCP的加强版本SSL，SSL是对TCP的加强，其本身不是一种协议，该加强应用于应用层。如果应用层使用了SSL，那应用层将明文数据传入SSL嵌套字，经SSL加密，传入TCP嵌套字，然后经网络传输到接收放TCP嵌套字。接收方TCP嵌套字再传入接收方SSL解密，然后传入应用层

#### UDP

它是无连接，不提供可靠数据传输和不提供拥塞控制，仅提供最小服务


----------

#### 应用层协议

* 定义了报文类型，例如请求报文和响应报文
* 各种报文的语法，报文中的各个字段和这些字段的描述
* 字段的语义，即字段包含的信息含义
* 进程如何和何时发送报文，和对报文响应规则

#### HTTP

HTTP使用TCP作为支撑运输协议

HTTP不保存客户的任何信息，所以我们说HTTP是**无状态协议**

HTTP同时支持**持续连接**和**非持续连接**,默认持续连接。持续连接就是公用一个TCP连接，非持续连接是每个HTTP连接都重新创建一个TCP连接，两个方式各有优劣，非持续连接每次HTTP请求都需要TCP三次握手，一次请求需要两次往返时间RTT(即从客户端发送请求到服务端响应，然后客户端接收响应的时间)

![图片](https://github.com/modonglinaguadu/study-note/blob/master/image/network/RTT.png)

持续连接中，一条连接如果间隔一段时间仍未使用(可以设置间隔时间)，HTTP服务器会关闭连接

#### HTTP报文格式

> 请求报文格式

![图片](https://github.com/modonglinaguadu/study-note/blob/master/image/network/http_request.png)

这个是典型的HTTP请求报文

第一行是**请求行**，后面的行是**请求头**(首部行)

> 请求行

请求行包含了方法字段，URL字段和HTTP版本字段

> 请求头(首部行)

* Host 指定主机
* Connection keep-alive告诉服务器保持持续连接，close是非持续连接
* Refere 来源网址，即从哪个网址来到这个网页


下图是HTTP请求报文结构，除了请求行和请求头，还有一个请求体
![图片](https://github.com/modonglinaguadu/study-note/blob/master/image/network/http_request_post.png)
![图片](https://github.com/modonglinaguadu/study-note/blob/master/image/network/http_request1.png)